#!/bin/bash

if [ $# != 0 ] ; then
    echo "Usage: $0  -- create the Venusian network interface" >&2
    exit 1
fi

set -ex
trap 'echo ERROR >&2; exit 1' ERR

if ip link del dev venusian 2>/dev/null ; then
     sleep 2  # Avahi gets confused otherwise
fi

ip link add name venusian type bridge
ip link set dev venusian up
ip addr add 192.168.42.254/24 dev venusian

sysctl -w net.ipv4.conf.venusian.forwarding=1
sysctl -w net.ipv4.ip_forward=1

sleep 3
ip addr add 192.168.42.254/24 dev venusian 2>/dev/null || true

